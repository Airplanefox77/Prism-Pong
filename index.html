<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prism Pong</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <main class="shell">
    <section class="hud">
      <article class="stat">
        <span class="label" id="pointsLabel">Points</span>
        <strong class="value" id="pointsValue">0</strong>
        <span class="hover-tip" id="pointsHover" aria-hidden="true">Shop Points: 0</span>
      </article>
      <article class="stat">
        <span class="label" id="missesLabel">Misses</span>
        <strong class="value" id="missesValue">0</strong>
        <span id="missesRatioTip" class="ratio-tip" aria-hidden="true"></span>
      </article>
      <article class="stat">
        <span class="label" id="streakLabel">Streak</span>
        <strong class="value" id="streakValue">0</strong>
      </article>
      <article class="stat">
        <span class="label">Event</span>
        <strong class="value" id="eventValue">None active</strong>
      </article>
    </section>

    <section class="board-wrap">
      <canvas id="pong" aria-label="Prism Pong Game"></canvas>

      <div id="eventToast" class="toast"></div>

      <div id="touchControls" class="touch-controls" aria-hidden="true">
        <div class="touch-side">
          <button class="touch-btn" type="button" data-touch-action="flick-up">
            <span class="touch-icon">UP</span>
            <span class="touch-label">Flick Up</span>
          </button>
          <button class="touch-btn" type="button" data-touch-action="flick-down">
            <span class="touch-icon">DN</span>
            <span class="touch-label">Flick Down</span>
          </button>
          <button class="touch-btn touch-overexpose" type="button" data-touch-action="overexpose">
            <span class="touch-icon">EX</span>
            <span class="touch-label">Overexpose</span>
          </button>
        </div>
        <button class="touch-btn touch-pause" type="button" data-touch-action="pause">
          <span class="touch-icon">PA</span>
          <span class="touch-label">Pause</span>
        </button>
      </div>

      <div id="pauseLayer" class="pause-layer" aria-hidden="true">
        <section class="pause-card" role="dialog" aria-modal="true" aria-labelledby="pauseTitle">
          <header class="pause-head">
            <h2 id="pauseTitle" class="pause-title">Paused</h2>
            <button id="closePauseBtn" class="ghost-btn" type="button">Resume</button>
          </header>

          <div id="pauseMain" class="menu-stack">
            <button id="pauseResumeBtn" class="menu-btn" type="button">Resume Game</button>
            <button id="pauseSettingsBtn" class="menu-btn" type="button">Settings</button>
            <button id="pauseShopBtn" class="menu-btn" type="button">Shop</button>
            <button id="pauseRestartBtn" class="menu-btn" type="button">Restart Match</button>
          </div>

          <div id="settingsPanel" class="settings-panel">
            <div class="settings-tabs" role="tablist" aria-label="Settings tabs">
              <button class="tab-btn active" data-tab-target="graphicsTab" type="button" role="tab">Graphics</button>
              <button class="tab-btn" data-tab-target="gameplayTab" type="button" role="tab">Gameplay</button>
              <button class="tab-btn" data-tab-target="audioTab" type="button" role="tab">Audio</button>
              <button class="tab-btn" data-tab-target="controlsTab" type="button" role="tab">Controls</button>
              <button class="tab-btn" data-tab-target="helpTab" type="button" role="tab">Help</button>
            </div>

            <section class="tab-panel active" id="graphicsTab" role="tabpanel">
              <label class="setting-line" for="autoGraphicsToggle">
                <span>Auto Performance</span>
                <input id="autoGraphicsToggle" class="toggle" type="checkbox" checked />
              </label>
              <p class="setting-note">When on, Prism Pong continuously adjusts visual quality for the best balance of smooth FPS and visual fidelity.</p>
              <label class="setting-line" for="perfToggle">
                <span>Manual Performance Mode</span>
                <input id="perfToggle" class="toggle" type="checkbox" />
              </label>
              <label class="setting-line" for="ultraPerfToggle">
                <span>Manual Ultra Performance</span>
                <input id="ultraPerfToggle" class="toggle" type="checkbox" />
              </label>
              <p class="setting-note">Manual options are available when Auto Performance is off.</p>
            </section>

            <section class="tab-panel" id="gameplayTab" role="tabpanel">
              <label class="setting-line" for="gameModeSelect">
                <span>Game Mode</span>
                <select id="gameModeSelect" class="select-input">
                  <option value="classic">Classic Prism</option>
                  <option value="chaos">Arcade Chaos</option>
                  <option value="duel">Duel Mode</option>
                  <option value="survival">Light Survival</option>
                </select>
              </label>
              <p class="setting-note">Classic: balanced events. Chaos: faster events. Duel: no random events. Survival: speed ramps every 10s.</p>

              <label class="setting-line" for="aiDifficulty">
                <span>AI Difficulty</span>
                <div class="slider-inline">
                  <input id="aiDifficulty" class="slider" type="range" min="1" max="10" step="1" value="6" />
                  <strong id="aiDifficultyValue" class="inline-value">6 / 10</strong>
                </div>
              </label>
              <p class="setting-note">Lower values add aiming mistakes and slower reactions. Higher values make AI more precise and aggressive.</p>

              <div class="score-columns">
                <article class="score-block">
                  <h3>Recent Score Log</h3>
                  <p class="setting-note">Recent matches clear automatically after 20 minutes.</p>
                  <ul id="recentScoreList" class="score-list"></ul>
                </article>
                <article class="score-block">
                  <h3>Top Scores</h3>
                  <p class="setting-note">Best runs are saved. Older weaker entries are trimmed over time.</p>
                  <ol id="topScoreList" class="score-list"></ol>
                </article>
              </div>
            </section>

            <section class="tab-panel" id="audioTab" role="tabpanel">
              <label class="setting-line" for="audioToggle">
                <span>Master Audio</span>
                <input id="audioToggle" class="toggle" type="checkbox" checked />
              </label>
              <label class="setting-line" for="masterVolume">
                <span>Master Volume</span>
                <input id="masterVolume" class="slider" type="range" min="0" max="1" step="0.01" value="0.8" />
              </label>
              <label class="setting-line" for="musicToggle">
                <span>Background Music</span>
                <input id="musicToggle" class="toggle" type="checkbox" checked />
              </label>
              <label class="setting-line" for="musicVolume">
                <span>Music Volume</span>
                <input id="musicVolume" class="slider" type="range" min="0" max="1" step="0.01" value="0.35" />
              </label>
              <label class="setting-line" for="sfxToggle">
                <span>Sound Effects</span>
                <input id="sfxToggle" class="toggle" type="checkbox" checked />
              </label>
              <label class="setting-line" for="sfxVolume">
                <span>SFX Volume</span>
                <input id="sfxVolume" class="slider" type="range" min="0" max="1" step="0.01" value="0.8" />
              </label>
            </section>

            <section class="tab-panel" id="controlsTab" role="tabpanel">
              <p class="setting-note">Move P1 with <strong>W/S</strong>, mouse, or touch drag. Flick controls for directional shots and 4-key combos:</p>
              <div class="key-grid">
                <div class="key-row">
                  <span id="keyA" class="key-chip">A</span>
                  <span>Down smash: sends ball down fast</span>
                </div>
                <div class="key-row">
                  <span id="keyD" class="key-chip">D</span>
                  <span>Up smash: sends ball up fast</span>
                </div>
                <div class="key-row">
                  <span id="keyE" class="key-chip">E</span>
                  <span>Use Overexpose when your prism meter is full</span>
                </div>
              </div>
              <label class="setting-line" for="pointerAssistToggle">
                <span>Mouse/Touch Assist</span>
                <input id="pointerAssistToggle" class="toggle" type="checkbox" checked />
              </label>
              <label class="setting-line" for="aiToggle">
                <span>AI Opponent Enabled</span>
                <input id="aiToggle" class="toggle" type="checkbox" checked />
              </label>
              <p class="setting-note">Disable AI for local 2-player mode. Player 2 uses Arrow Up/Down + Left/Right flicks, presses <strong>/</strong> for Overexpose, and can chain combos with Left/Right sequences.</p>

              <div id="manualBlock" class="manual-block">
                <div class="key-grid">
                  <div class="key-row">
                    <span class="key-chip">UP</span>
                    <span class="key-chip">DOWN</span>
                    <span>Move paddle</span>
                  </div>
                  <div class="key-row">
                    <span id="keyLeft" class="key-chip">LEFT</span>
                    <span>Up smash for player 2</span>
                  </div>
                  <div class="key-row">
                    <span id="keyRight" class="key-chip">RIGHT</span>
                    <span>Down smash for player 2</span>
                  </div>
                  <div class="key-row">
                    <span id="keySlash" class="key-chip">/</span>
                    <span>Overexpose for player 2 when prism is full</span>
                  </div>
                </div>
              </div>
            </section>

            <section class="tab-panel" id="helpTab" role="tabpanel">
              <article class="help-block">
                <h3>Advanced Quick Start</h3>
                <p>Every clean return builds streak and prism charge. In AI mode, points come from beating the right paddle; misses climb when the AI scores on you.</p>
                <ul class="help-list">
                  <li>Flick shots change ball speed and angle without losing control.</li>
                  <li>Combos queue for a short window. Chain them for burst pressure.</li>
                  <li>Overexpose turns your prism into a temporary power play.</li>
                </ul>
              </article>
              <article class="help-block">
                <h3>Combos & Flicks</h3>
                <p>Use directional flicks to prime 4-key combos before the combo window expires:</p>
                <div class="key-grid">
                  <div class="key-row"><span class="key-chip">A D D A</span><span>Prism Zigzag: sharp, flat zigzag drive</span></div>
                  <div class="key-row"><span class="key-chip">A D D D</span><span>Down Burst: steep, fast downward launch</span></div>
                  <div class="key-row"><span class="key-chip">D A A A</span><span>Up Burst: steep, fast upward launch</span></div>
                  <div class="key-row"><span class="key-chip">A D A D</span><span>Curve Up: rising curve with late bend</span></div>
                  <div class="key-row"><span class="key-chip">D A D A</span><span>Curve Down: falling curve with late bend</span></div>
                </div>
                <p>Combo inputs are mirrored for Player 2 flicks. Time them while the ball is near your paddle.</p>
              </article>
              <article class="help-block help-desktop">
                <h3>Desktop Controls</h3>
                <ul class="help-list">
                  <li>P1 move: <strong>W / S</strong>, mouse, or touch drag.</li>
                  <li>P1 flicks: <strong>A</strong> (down) and <strong>D</strong> (up).</li>
                  <li>Overexpose: <strong>E</strong> when prism is full.</li>
                  <li>P2 move: <strong>Arrow Up / Down</strong> when AI is off.</li>
                  <li>P2 flicks: <strong>Arrow Left / Right</strong>; Overexpose with <strong>/</strong>.</li>
                  <li>Pause: <strong>Esc</strong> or <strong>P</strong>.</li>
                </ul>
              </article>
              <article class="help-block help-touch">
                <h3>Touch Controls</h3>
                <ul class="help-list">
                  <li>Drag on the arena to move the paddle.</li>
                  <li>Use side buttons for Flick Up, Flick Down, and Overexpose.</li>
                  <li>Use the bottom Pause button to open the pause menu.</li>
                  <li>Touch mode keeps the AI opponent enabled.</li>
                </ul>
              </article>
              <article class="help-block">
                <h3>Prism Meter & Overexpose</h3>
                <p>Returns charge your prism meter. At 100%, trigger Overexpose to supercharge shots and briefly slow your opponent before the meter resets.</p>
              </article>
              <article class="help-block">
                <h3>Special Events</h3>
                <ul class="help-list">
                  <li><strong>Large Ball:</strong> bigger ball plus smaller paddles.</li>
                  <li><strong>Rainbow Ball:</strong> 2x points and fewer misses on return.</li>
                  <li><strong>Freeze Ball:</strong> ball speed drops to 25% for the duration.</li>
                  <li><strong>Sticky Ball:</strong> paddle catches the ball briefly on impact.</li>
                </ul>
                <p>Duel mode disables random events.</p>
              </article>
              <article class="help-block">
                <h3>Modes & Scoring</h3>
                <ul class="help-list">
                  <li><strong>Classic Prism:</strong> balanced event timing.</li>
                  <li><strong>Arcade Chaos:</strong> faster event cadence.</li>
                  <li><strong>Duel Mode:</strong> pure rallies with no random events.</li>
                  <li><strong>Light Survival:</strong> speed ramps every 10 seconds.</li>
                </ul>
                <p>Local 2-player shares a point bank; hover Points to see the total.</p>
              </article>
              <article class="help-block">
                <h3>Advanced Tips</h3>
                <ul class="help-list">
                  <li>Flick early to redirect shots before contact.</li>
                  <li>Curve combos are strongest when the opponent overcommits.</li>
                  <li>Stack streaks before triggering Overexpose for max tempo.</li>
                </ul>
              </article>
            </section>

            <button id="settingsBackBtn" class="ghost-btn" type="button">Back</button>
          </div>

          <div id="shopPanel" class="settings-panel">
            <div class="shop-head">
              <h3>Shop</h3>
              <span class="shop-points">Points: <strong id="shopPointsValue">0</strong></span>
            </div>
            <p class="setting-note">Spend points to unlock cosmetic skins and board themes. Rainbow paddle costs 350 points.</p>

            <div class="settings-tabs" role="tablist" aria-label="Shop tabs">
              <button class="shop-tab-btn active" data-shop-tab-target="shopPaddleTab" type="button" role="tab">Paddle Skins</button>
              <button class="shop-tab-btn" data-shop-tab-target="shopBallTab" type="button" role="tab">Ball Skins</button>
              <button class="shop-tab-btn" data-shop-tab-target="shopThemeTab" type="button" role="tab">Arena Themes</button>
            </div>

            <section class="shop-tab-panel active" id="shopPaddleTab" role="tabpanel">
              <div id="shopPaddleGrid" class="shop-grid"></div>
            </section>
            <section class="shop-tab-panel" id="shopBallTab" role="tabpanel">
              <div id="shopBallGrid" class="shop-grid"></div>
            </section>
            <section class="shop-tab-panel" id="shopThemeTab" role="tabpanel">
              <div id="shopThemeGrid" class="shop-grid"></div>
            </section>

            <button id="shopBackBtn" class="ghost-btn" type="button">Back</button>
          </div>
        </section>
        <div id="deviceConfirm" class="device-confirm" aria-hidden="true">
          <div class="device-card" role="dialog" aria-modal="true" aria-labelledby="deviceConfirmTitle">
            <h3 id="deviceConfirmTitle">Did we guess your device correctly?</h3>
            <p id="deviceConfirmMessage" class="device-note">We think you're on a mobile device.</p>
            <div class="device-actions">
              <button id="deviceConfirmYes" class="menu-btn" type="button">Yes</button>
              <button id="deviceConfirmNo" class="ghost-btn" type="button">No</button>
            </div>
            <div id="deviceConfirmOptions" class="device-options" aria-hidden="true">
              <p class="device-note">Choose your device for scaling:</p>
              <div class="device-option-grid">
                <button class="menu-btn" type="button" data-device-option="mobile">Mobile</button>
                <button class="menu-btn" type="button" data-device-option="tablet">Tablet</button>
                <button class="menu-btn" type="button" data-device-option="desktop">Desktop</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

      <div class="prism-meters" aria-hidden="true">
        <aside id="prismLeft" class="prism-meter left">
          <span class="prism-side-label">P1</span>
          <div class="prism-track">
            <div id="prismMeterLeftFill" class="prism-fill"></div>
          </div>
          <span id="prismMeterLeftText" class="prism-meter-text">0%</span>
        </aside>
        <aside id="prismRight" class="prism-meter right">
          <span id="prismRightLabel" class="prism-side-label">AI</span>
          <div class="prism-track">
            <div id="prismMeterRightFill" class="prism-fill"></div>
          </div>
          <span id="prismMeterRightText" class="prism-meter-text">0%</span>
        </aside>
      </div>

    <section class="toolbar">
      <div class="toolbar-right">
        <span id="modeBadge" class="mode-badge">Opponent: AI</span>
        <button id="resetBtn" type="button">Reset Match</button>
      </div>
    </section>
  </main>

  <div id="devicePrompt" class="device-prompt" aria-hidden="true">
    <div class="device-card" role="dialog" aria-modal="true" aria-labelledby="devicePromptTitle">
      <button id="devicePromptClose" class="icon-btn" type="button" aria-label="Dismiss device scaling prompt">X</button>
      <h3 id="devicePromptTitle">Switch to mobile scaling?</h3>
      <p id="devicePromptMessage" class="device-note">Switch to mobile scaling for better controls and layout.</p>
      <div class="device-actions">
        <button id="devicePromptYes" class="menu-btn" type="button">Yes, switch</button>
        <button id="devicePromptNo" class="ghost-btn" type="button">Not now</button>
      </div>
    </div>
  </div>

  <div id="orientationPrompt" class="orientation-prompt" aria-hidden="true">
    <div class="orientation-card">
      <strong>Rotate to landscape</strong>
      <span>Prism Pong plays best in landscape mode.</span>
    </div>
  </div>

  <script src="device.js"></script>
  <script src="game.js"></script>
</body>
</html>
